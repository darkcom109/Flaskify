{% extends 'base.html' %}

{% block navigation_items %}
    {% include 'components/nav_component.html' %}
{% endblock %}

{% block section %}
<div class="container font-for-text">
    <h1 class="text-center">Your Dashboard</h1>
    <p class="text-center fs-6">Your Progress</p>

    <div class="progress mb-4 font-for-text me-auto ms-auto" style="height: 20px; width: 50%">
        <div id="progress-bar" class="progress-bar progress-bar-styling" role="progressbar" style="width:0%">
            0%
        </div>
    </div>

    <div class="accordion" id="lessonAccordion">

  <!-- Section 1 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
        Introduction to Flask
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
            <li class="list-group-item">
                <input type="checkbox" 
                       class="lesson-check item-styling"
                       data-lesson-id="lesson_zero"
                       {% if "lesson_zero" in user_progress%}checked{% endif %}> 
                <a href="{{url_for('lesson', lesson='lesson_zero')}}" class="margin-left-styling">Welcome to Flaskify!</a>
            </li>
            <li class="list-group-item">
                <input type="checkbox" 
                       class="lesson-check item-styling"
                       data-lesson-id="lesson_one"
                       {% if "lesson_one" in user_progress%}checked{% endif %}>
                <a href="{{url_for('lesson', lesson='lesson_one')}}" class="margin-left-styling">Setup & Hello World</a>
            </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 2 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
        The Fundamentals of Flask
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_two"
                   {% if "lesson_two" in user_progress%}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_two')}}" class="margin-left-styling">Routes & Views</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_three"
                   {% if "lesson_three" in user_progress%}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_three')}}" class="margin-left-styling">Templates & Jinja Basics</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_four"
                   {% if "lesson_four" in user_progress%}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_four')}}" class="margin-left-styling">Static Files</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 3 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
        Developing User Interaction
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_five"
                   {% if "lesson_five" in user_progress%}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_five')}}" class="margin-left-styling">Forms & User Input</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_six"
                   {% if "lesson_six" in user_progress%}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_six')}}" class="margin-left-styling">Flash Messages & Feedback</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 4 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingFour">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
        Project One - Mini Blog
      </button>
    </h2>
    <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="project_one"
                   {% if "project_one" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='project_one')}}" class="margin-left-styling">Complete your First Project</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 5 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingFive">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">
        Databases
      </button>
    </h2>
    <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_seven"
                   {% if "lesson_seven" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_seven')}}" class="margin-left-styling">Databases with SQLite</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_eight"
                   {% if "lesson_eight" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_eight')}}" class="margin-left-styling">SQLAlchemy Models & Queries</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_nine"
                   {% if "lesson_nine" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_nine')}}" class="margin-left-styling">Database Migrations with Flask-Migrate</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 6 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingSix">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix">
        Authentication
      </button>
    </h2>
    <div id="collapseSix" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_ten"
                   {% if "lesson_ten" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_ten')}}" class="margin-left-styling">Sessions & Cookies</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_eleven"
                   {% if "lesson_eleven" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_eleven')}}" class="margin-left-styling">Flask-Login Basics</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_twelve"
                   {% if "lesson_twelve" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_twelve')}}" class="margin-left-styling">Protecting Routes & User Roles</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 7 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingSeven">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven">
        Error Handling and Intermediate Jinja
      </button>
    </h2>
    <div id="collapseSeven" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_thirteen"
                   {% if "lesson_thirteen" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_thirteen')}}" class="margin-left-styling">Custom Error Pages and Handling</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_fourteen"
                   {% if "lesson_fourteen" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_fourteen')}}" class="margin-left-styling">Jinja Macros & Template Inheritance</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 8 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingEight">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight">
        Introduction to REST APIs
      </button>
    </h2>
    <div id="collapseEight" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_fifteen"
                   {% if "lesson_fifteen" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_fifteen')}}" class="margin-left-styling">Building REST APIs in Flask</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_sixteen"
                   {% if "lesson_sixteen" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_sixteen')}}" class="margin-left-styling">Consuming APIs with Fetch/AJAX</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_seventeen"
                   {% if "lesson_seventeen" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_seventeen')}}" class="margin-left-styling">Returning Database Data as JSON</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 9 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingNine">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNine">
        Blueprints, Testing and Deployment
      </button>
    </h2>
    <div id="collapseNine" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_eighteen"
                   {% if "lesson_eighteen" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_eighteen')}}" class="margin-left-styling">Blueprints</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_nineteen"
                   {% if "lesson_nineteen" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_nineteen')}}" class="margin-left-styling">Testing Your Flask App</a>
          </li>
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="lesson_twenty"
                   {% if "lesson_twenty" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='lesson_twenty')}}" class="margin-left-styling">Deployment Basics</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Section 10 -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingTen">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTen">
        Project Two - User Dashboard App
      </button>
    </h2>
    <div id="collapseTen" class="accordion-collapse collapse" data-bs-parent="#lessonAccordion">
      <div class="accordion-body">
        <ul class="list-group">
          <li class="list-group-item">
            <input type="checkbox" 
                   class="lesson-check item-styling"
                   data-lesson-id="project_two"
                   {% if "project_two" in user_progress %}checked{% endif %}>
            <a href="{{url_for('lesson', lesson='project_two')}}" class="margin-left-styling">Complete Your Second Project</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

</div>

    <script>
      const checkboxes = document.querySelectorAll(".lesson-check");
      const progress = document.getElementById("progress-bar");

      function updateProgress() {
          const completed = Array.from(checkboxes)
              .filter(cb => cb.checked)
              .map(cb => cb.dataset.lessonId);

          const percent = Math.round((completed.length / checkboxes.length) * 100);
          progress.style.width = percent + "%";
          progress.textContent = percent + "%";

          fetch("/save_progress", {
              method: "POST",
              headers: {"Content-Type": "application/json"},
              body: JSON.stringify({ completed_lessons: completed })
          });
      }

      checkboxes.forEach(cb => cb.addEventListener("change", updateProgress));
      updateProgress(); // call once on load so bar is correct
    </script>

</div>
{% endblock %}