{% extends 'base.html' %}

{% block navigation_items %}
    {% include 'components/nav_component.html' %}
{% endblock %}

{% block section %}
<div class="container font-for-text">
    <div class="text-center mt-2">
        <h1 class="mb-3">Lesson 17: Returning Database Data as JSON</h1>
        <p class="lead">In this lesson, you’ll learn how to return data from your database in JSON format so other apps (or your frontend JavaScript) can use it.</p>
    </div>

    <hr>

    <h3>Step 1: A Simple Model</h3>
    <pre><code>
{% raw %}
class Post(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(100), nullable=False)
    content = db.Column(db.Text, nullable=False)

    def to_dict(self):
        return {
            "id": self.id,
            "title": self.title,
            "content": self.content
        }
{% endraw %}
    </code></pre>
    <p>
        The <code>to_dict()</code> method turns a SQLAlchemy object into a dictionary, which Flask can easily convert to JSON.
    </p>

    <h3>Step 2: Returning All Posts as JSON</h3>
    <pre><code>
{% raw %}
from flask import jsonify

@app.route("/api/posts")
def api_posts():
    posts = Post.query.all()
    return jsonify([p.to_dict() for p in posts])
{% endraw %}
    </code></pre>
    <p>
        Visit <code>/api/posts</code> in your browser and you’ll see JSON data instead of HTML.
    </p>

    <h3>Step 3: Returning a Single Post</h3>
    <pre><code>
{% raw %}
@app.route("/api/posts/&lt;int:post_id&gt;")
def api_post(post_id):
    post = Post.query.get_or_404(post_id)
    return jsonify(post.to_dict())
{% endraw %}
    </code></pre>
    <p>
        Example: <code>/api/posts/1</code> → returns the first post as JSON.
    </p>

    <h3>Step 4: Sending JSON Data into the Database</h3>
    <pre><code>
{% raw %}
@app.route("/api/posts", methods=["POST"])
def create_post():
    data = request.get_json()
    new_post = Post(title=data["title"], content=data["content"])
    db.session.add(new_post)
    db.session.commit()
    return jsonify(new_post.to_dict()), 201
{% endraw %}
    </code></pre>
    <p>
        Now your app can <strong>create</strong> posts directly from JSON input.
    </p>

    <h3>Step 5: Why This Matters</h3>
    <p>
        Returning database data as JSON turns your Flask app into a real backend service — powering websites, mobile apps, or even other APIs.
    </p>

    <div class="d-flex justify-content-center">
        <a href="{{ url_for('dashboard') }}" class="btn button-bg-style mt-4">Back to Dashboard</a>
    </div>
</div>
{% endblock %}
